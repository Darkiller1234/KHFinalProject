<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace: 해당 mapper파일의 고유한 별칭 -->
<mapper namespace="managerMapper">
  <resultMap type="License2" id="LicenseResultSet">
	<result column="SYMBOL_LICENSE" property="symbolLicense"/>
	<result column="MEMBER_NO" property="memberNo"/>
  	<result column="LICENSE_NO" property="licenseNo"/>
  	<result column="LICENSE_IMG" property="licenseImg"/>
  	<result column="CONFIRM_DATE" property="confirmDate"/>
  	<result column="LICENSE_NAME" property="licenseName"/>
  	<result column="LICENSE_DESC" property="licenseDesc"/>
  	<result column="MEMBER_NICKNAME" property="memberName"/>
  </resultMap>

  <select id="countLicenseList" resultType="int">
	SELECT COUNT(*)
	FROM MEMBER_LICENSE ML
	INNER JOIN MEMBER M ON (ML.MEMBER_NO = M.MEMBER_NO)
	WHERE CONFIRM_DATE IS NULL
	<if test="keyword != null">
		AND MEMBER_NICKNAME LIKE '%' || #{keyword} || '%'
	</if>
  </select>
  
   <select id="selectLicenseList" resultMap="LicenseResultSet">
		SELECT ML.LICENSE_NO LICENSE_NO,
		    L.LICENSE_NAME,
		    ML.MEMBER_NO MEMBER_NO,
		    ML.LICENSE_IMG LICENSE_IMG,
		    M.MEMBER_NICKNAME MEMBER_NICKNAME
		FROM MEMBER_LICENSE ML
		INNER JOIN MEMBER M ON (ML.MEMBER_NO = M.MEMBER_NO)
		INNER JOIN LICENSE L ON (L.LICENSE_NO = ML.LICENSE_NO)
		WHERE CONFIRM_DATE IS NULL
	<if test="keyword != null">
		AND MEMBER_NICKNAME LIKE '%' || #{keyword} || '%'
	</if>
  </select>
  
  <select id="getReportedId" resultType="_int">
  	SELECT 
  		<if test="name.equals('스터디')">
  			STUDY_BOARD_NO
  		</if>
  		<if test="name.equals('댓글')">
  			REPLY_NO
  		</if>
  		<if test="name.equals('글')">
  			BOARD_NO
  		</if>
  		<if test="name.equals('메세지')">
  			MESSAGE_NO
  		</if>
  	FROM REPORT
  	WHERE REPORT_NO = #{reportNo}
  </select>
  
  <delete id="deleteMessage">
  	DELETE 
  	FROM MESSAGE
  	WHERE MESSAGE_NO = #{id}
  </delete>
  UPDATE BOARD
  	SET
  	VIEW_COUNT = VIEW_COUNT + 1
  	WHERE
  	BOARD_NO = #{cno}
  <update id="deleteReported">
  	UPDATE
  		<if test="name.equals('스터디')">
  			STUDY_BOARD
  		</if>
  		<if test="name.equals('댓글')">
  			REPLY
  		</if>
  		<if test="name.equals('글')">
  			BOARD
  		</if>
  		<if test="name.equals('메세지')">
  			MESSAGE
  		</if>
  	SET
  	STATUS = "N"
  	WHERE
  		<if test="name.equals('스터디')">
  			STUDY_BOARD_NO = #{id}
  		</if>
  		<if test="name.equals('댓글')">
  			REPLY_NO = #{id}
  		</if>
  		<if test="name.equals('글')">
  			BOARD_NO = #{id}
  		</if>
  		<if test="name.equals('메세지')">
  			MESSAGE_NO = #{id}
  		</if>
  </update>

	<delete id="deleteReport">
		DELETE 
		FROM REPORT
		WHERE REPORT_NO = #{reportNo}
	</delete>
</mapper>

